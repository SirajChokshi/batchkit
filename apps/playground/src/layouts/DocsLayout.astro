---
import { getCollection } from 'astro:content';
import Layout from './Layout.astro';
import TableOfContents from '../components/TableOfContents.svelte';

interface Props {
  title: string;
}

const { title } = Astro.props;
const docs = await getCollection('docs');
const sorted = docs.sort((a, b) => (a.data.order ?? 0) - (b.data.order ?? 0));
const currentPath = Astro.url.pathname;
---

<Layout title={`${title} - batchkit`}>
  <div class="docs-layout">
    <!-- Left sidebar -->
    <aside class="docs-left">
      <div class="text-stone-400 text-xs tracking-widest pl-4 mb-3 uppercase font-mono">Pages</div>
      <nav class="flex flex-col gap-0.5">
        {sorted.map((doc) => (
          <a
            href={`/docs/${doc.id}`}
            class:list={[
              "text-sm font-mono px-4 py-2.5",
              currentPath.includes(doc.id) ? "text-stone-100 bg-stone-800" : "text-stone-500 hover:bg-stone-50 hover:text-stone-950"
            ]}
          >
            {doc.data.title}
          </a>
        ))}
      </nav>
    </aside>

    <!-- Main content -->
    <article class="prose-docs docs-main">
      <slot />
    </article>

    <!-- Right sidebar -->
    <aside class="docs-right">
      <TableOfContents client:load />
    </aside>
  </div>
</Layout>

<style>
  .docs-layout {
    --header-h: 3rem;
    --left-w: 14rem;
    --right-w: 14rem;
    --gap: 2rem;
    display: flex;
    padding-top: 1.5rem;
  }

  .docs-left,
  .docs-right {
    position: fixed;
    top: var(--header-h);
    height: calc(100vh - var(--header-h));
    padding-block: 1.5rem;
    overflow-y: auto;
  }

  .docs-left {
    left: max(0px, calc((100vw - 80rem) / 2));
    width: var(--left-w);
    padding-right: var(--gap);
  }

  .docs-right {
    right: max(0px, calc((100vw - 80rem) / 2));
    width: var(--right-w);
    padding-left: 1rem;
  }

  .docs-main {
    flex: 1;
    margin-left: calc(var(--left-w) + var(--gap));
    margin-right: calc(var(--right-w) + var(--gap));
    padding: 1.5rem 2rem 8rem;
  }
</style>
