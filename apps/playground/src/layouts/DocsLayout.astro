---
import { getCollection } from 'astro:content';
import Layout from './Layout.astro';
import TableOfContents from '../components/TableOfContents.svelte';

interface Props {
  title: string;
}

const { title } = Astro.props;
const docs = await getCollection('docs');
const sorted = docs.sort((a, b) => (a.data.order ?? 0) - (b.data.order ?? 0));
const currentPath = Astro.url.pathname;
---

<Layout title={`${title} - batchkit`}>
  <div class="pt-6 relative">
    <!-- Left sidebar - hidden on mobile, shown on lg+ -->
    <aside class="hidden lg:block fixed top-12 left-[max(0px,calc((100vw-80rem)/2))] w-56 h-[calc(100vh-3rem)] py-6 pr-8 overflow-y-auto">
      <div class="text-stone-400 text-xs tracking-widest pl-4 mb-3 uppercase font-mono">Pages</div>
      <nav class="flex flex-col gap-0.5">
        {sorted.map((doc) => (
          <a
            href={`/docs/${doc.id}`}
            class:list={[
              "text-sm font-mono px-4 py-2.5",
              currentPath.includes(doc.id) ? "text-stone-100 bg-stone-800" : "text-stone-500 hover:bg-stone-50 hover:text-stone-950"
            ]}
          >
            {doc.data.title}
          </a>
        ))}
      </nav>
    </aside>

    <!-- Mobile navigation - shown only on mobile -->
    <nav class="lg:hidden flex flex-wrap gap-2 mb-6 pb-4 border-b border-stone-700">
      {sorted.map((doc) => (
        <a
          href={`/docs/${doc.id}`}
          class:list={[
            "text-sm font-mono px-3 py-1.5",
            currentPath.includes(doc.id) ? "text-stone-100 bg-stone-800" : "text-stone-500 hover:bg-stone-50 hover:text-stone-950"
          ]}
        >
          {doc.data.title}
        </a>
      ))}
    </nav>

    <!-- Main content -->
    <article class="prose-docs lg:ml-56 lg:pl-8 xl:mr-56 xl:pr-4 pb-32">
      <slot />
    </article>

    <!-- Right sidebar - hidden on mobile and tablet, shown on xl+ -->
    <aside class="hidden xl:block fixed top-12 right-[max(0px,calc((100vw-80rem)/2))] w-56 h-[calc(100vh-3rem)] py-6 pl-4 overflow-y-auto">
      <TableOfContents client:load />
    </aside>
  </div>
</Layout>
