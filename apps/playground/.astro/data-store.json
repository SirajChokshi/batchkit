[["Map",1,2,7,8],"meta::meta",["Map",3,4,5,6],"astro-version","5.0.0","config-digest","708caaf2a7108479","docs",["Map",9,10,71,72,110,111],"api",{"id":9,"data":11,"body":15,"filePath":16,"digest":17,"rendered":18},{"title":12,"description":13,"order":14},"API Reference","Complete API documentation",2,"# API Reference\n\n## batch()\n\nCreates a batcher.\n\n```typescript\nfunction batch\u003CK, V>(\n  fn: (keys: K[], signal: AbortSignal) => Promise\u003CV[] | Record\u003Cstring, V>>,\n  match: keyof V | typeof indexed | ((results: V[], key: K) => V | undefined),\n  options?: BatchOptions\n): Batcher\u003CK, V>\n```\n\n### Parameters\n\n| Parameter | Type | Description |\n|-----------|------|-------------|\n| `fn` | `(keys, signal) => Promise` | Batch function that fetches multiple items |\n| `match` | `string \\| symbol \\| function` | How to match results to keys |\n| `options` | `BatchOptions` | Optional configuration |\n\n### BatchOptions\n\n```typescript\ninterface BatchOptions {\n  wait?: number           // ms to wait before dispatching (default: 0)\n  max?: number            // Maximum batch size (default: unlimited)\n  schedule?: Scheduler    // Custom scheduler\n  name?: string           // Name for debugging\n  trace?: TraceHandler    // Event handler for debugging\n  key?: (k: K) => unknown // Custom key function for deduplication\n}\n```\n\n## Batcher\n\nThe object returned by `batch()`.\n\n### .get()\n\n```typescript\nget(key: K, options?: { signal?: AbortSignal }): Promise\u003CV>\nget(keys: K[], options?: { signal?: AbortSignal }): Promise\u003CV[]>\n```\n\nFetch one or more items. Requests in the same tick are batched together.\n\n### .flush()\n\n```typescript\nflush(): Promise\u003Cvoid>\n```\n\nDispatch pending requests immediately, bypassing the scheduler.\n\n### .abort()\n\n```typescript\nabort(): void\n```\n\nCancel all pending requests. Rejects with `AbortError`.\n\n### .name\n\n```typescript\nreadonly name?: string\n```\n\nThe name passed to `batch()`, if any.\n\n## indexed\n\nSymbol for matching object/record responses.\n\n```typescript\nimport { batch, indexed } from 'batchkit'\n\nconst users = batch(\n  (ids) => fetchUsersAsObject(ids),  // Returns { \"1\": user1, \"2\": user2 }\n  indexed\n)\n```\n\n## Schedulers\n\n### onAnimationFrame\n\n```typescript\nimport { onAnimationFrame } from 'batchkit'\n\nbatch(fn, 'id', { schedule: onAnimationFrame })\n```\n\nDispatches on the next animation frame. Syncs with browser rendering.\n\n### onIdle\n\n```typescript\nimport { onIdle } from 'batchkit'\n\nbatch(fn, 'id', { schedule: onIdle() })\nbatch(fn, 'id', { schedule: onIdle({ timeout: 100 }) })\n```\n\nDispatches when the browser is idle. Falls back to `setTimeout` in non-browser environments.\n\n### Custom Scheduler\n\n```typescript\ntype Scheduler = (dispatch: () => void) => () => void\n```\n\nA scheduler receives a dispatch function and returns a cleanup function.\n\n```typescript\nconst debounced: Scheduler = (dispatch) => {\n  const id = setTimeout(dispatch, 100)\n  return () => clearTimeout(id)\n}\n\nbatch(fn, 'id', { schedule: debounced })\n```\n\n## TraceEvent\n\nEvents emitted when `trace` is provided.\n\n```typescript\ntype TraceEvent =\n  | { type: 'get'; key: K; timestamp: number }\n  | { type: 'dedup'; key: K; timestamp: number }\n  | { type: 'schedule'; batchId: string; size: number; timestamp: number }\n  | { type: 'dispatch'; batchId: string; keys: K[]; timestamp: number }\n  | { type: 'resolve'; batchId: string; duration: number; timestamp: number }\n  | { type: 'error'; batchId: string; error: Error; timestamp: number }\n  | { type: 'abort'; batchId: string; timestamp: number }\n```\n\n## BatchError\n\nThrown when batchkit encounters an error (e.g., no matching result for a key).\n\n```typescript\nimport { BatchError } from 'batchkit'\n\ntry {\n  await users.get(999)\n} catch (e) {\n  if (e instanceof BatchError) {\n    // Handle batch-level error\n  }\n}\n```","src/content/docs/api.md","eee029f7b3181111",{"html":19,"metadata":20},"\u003Ch1 id=\"api-reference\">API Reference\u003C/h1>\n\u003Ch2 id=\"batch\">batch()\u003C/h2>\n\u003Cp>Creates a batcher.\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">function\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">&#x3C;\u003C/span>\u003Cspan style=\"color:#5DA994\">K\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#5DA994\"> V\u003C/span>\u003Cspan style=\"color:#666666\">>(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">  fn\u003C/span>\u003Cspan style=\"color:#666666\">: (\u003C/span>\u003Cspan style=\"color:#BD976A\">keys\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">K\u003C/span>\u003Cspan style=\"color:#666666\">[], \u003C/span>\u003Cspan style=\"color:#BD976A\">signal\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">AbortSignal\u003C/span>\u003Cspan style=\"color:#666666\">) => \u003C/span>\u003Cspan style=\"color:#5DA994\">Promise\u003C/span>\u003Cspan style=\"color:#666666\">&#x3C;\u003C/span>\u003Cspan style=\"color:#5DA994\">V\u003C/span>\u003Cspan style=\"color:#666666\">[] | \u003C/span>\u003Cspan style=\"color:#5DA994\">Record\u003C/span>\u003Cspan style=\"color:#666666\">&#x3C;\u003C/span>\u003Cspan style=\"color:#5DA994\">string\u003C/span>\u003Cspan style=\"color:#666666\">, \u003C/span>\u003Cspan style=\"color:#5DA994\">V\u003C/span>\u003Cspan style=\"color:#666666\">>>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  match\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#CB7676\">keyof\u003C/span>\u003Cspan style=\"color:#5DA994\"> V\u003C/span>\u003Cspan style=\"color:#666666\"> | \u003C/span>\u003Cspan style=\"color:#CB7676\">typeof\u003C/span>\u003Cspan style=\"color:#BD976A\"> indexed\u003C/span>\u003Cspan style=\"color:#666666\"> | ((\u003C/span>\u003Cspan style=\"color:#BD976A\">results\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">V\u003C/span>\u003Cspan style=\"color:#666666\">[], \u003C/span>\u003Cspan style=\"color:#BD976A\">key\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">K\u003C/span>\u003Cspan style=\"color:#666666\">) => \u003C/span>\u003Cspan style=\"color:#5DA994\">V\u003C/span>\u003Cspan style=\"color:#666666\"> | \u003C/span>\u003Cspan style=\"color:#CB7676\">undefined\u003C/span>\u003Cspan style=\"color:#666666\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  options\u003C/span>\u003Cspan style=\"color:#CB7676\">?\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">BatchOptions\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">):\u003C/span>\u003Cspan style=\"color:#5DA994\"> Batcher\u003C/span>\u003Cspan style=\"color:#666666\">&#x3C;\u003C/span>\u003Cspan style=\"color:#5DA994\">K\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#5DA994\"> V\u003C/span>\u003Cspan style=\"color:#666666\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"parameters\">Parameters\u003C/h3>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Parameter\u003C/th>\u003Cth>Type\u003C/th>\u003Cth>Description\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode>fn\u003C/code>\u003C/td>\u003Ctd>\u003Ccode>(keys, signal) => Promise\u003C/code>\u003C/td>\u003Ctd>Batch function that fetches multiple items\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>match\u003C/code>\u003C/td>\u003Ctd>\u003Ccode>string | symbol | function\u003C/code>\u003C/td>\u003Ctd>How to match results to keys\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>options\u003C/code>\u003C/td>\u003Ctd>\u003Ccode>BatchOptions\u003C/code>\u003C/td>\u003Ctd>Optional configuration\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch3 id=\"batchoptions\">BatchOptions\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">interface\u003C/span>\u003Cspan style=\"color:#5DA994\"> BatchOptions\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  wait\u003C/span>\u003Cspan style=\"color:#CB7676\">?\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#758575DD\">           // ms to wait before dispatching (default: 0)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  max\u003C/span>\u003Cspan style=\"color:#CB7676\">?\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#758575DD\">            // Maximum batch size (default: unlimited)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  schedule\u003C/span>\u003Cspan style=\"color:#CB7676\">?\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">Scheduler\u003C/span>\u003Cspan style=\"color:#758575DD\">    // Custom scheduler\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  name\u003C/span>\u003Cspan style=\"color:#CB7676\">?\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">string\u003C/span>\u003Cspan style=\"color:#758575DD\">           // Name for debugging\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  trace\u003C/span>\u003Cspan style=\"color:#CB7676\">?\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">TraceHandler\u003C/span>\u003Cspan style=\"color:#758575DD\">    // Event handler for debugging\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">  key\u003C/span>\u003Cspan style=\"color:#CB7676\">?\u003C/span>\u003Cspan style=\"color:#666666\">: (\u003C/span>\u003Cspan style=\"color:#BD976A\">k\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">K\u003C/span>\u003Cspan style=\"color:#666666\">) => \u003C/span>\u003Cspan style=\"color:#5DA994\">unknown\u003C/span>\u003Cspan style=\"color:#758575DD\"> // Custom key function for deduplication\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"batcher\">Batcher\u003C/h2>\n\u003Cp>The object returned by \u003Ccode>batch()\u003C/code>.\u003C/p>\n\u003Ch3 id=\"get\">.get()\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">key\u003C/span>\u003Cspan style=\"color:#DBD7CAEE\">: \u003C/span>\u003Cspan style=\"color:#BD976A\">K\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> options\u003C/span>\u003Cspan style=\"color:#CB7676\">?:\u003C/span>\u003Cspan style=\"color:#666666\"> { signal?: \u003C/span>\u003Cspan style=\"color:#BD976A\">AbortSignal\u003C/span>\u003Cspan style=\"color:#666666\"> })\u003C/span>\u003Cspan style=\"color:#DBD7CAEE\">: \u003C/span>\u003Cspan style=\"color:#B8A965\">Promise\u003C/span>\u003Cspan style=\"color:#666666\">&#x3C;\u003C/span>\u003Cspan style=\"color:#BD976A\">V\u003C/span>\u003Cspan style=\"color:#666666\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">keys\u003C/span>\u003Cspan style=\"color:#DBD7CAEE\">: \u003C/span>\u003Cspan style=\"color:#BD976A\">K\u003C/span>\u003Cspan style=\"color:#666666\">[],\u003C/span>\u003Cspan style=\"color:#BD976A\"> options\u003C/span>\u003Cspan style=\"color:#CB7676\">?:\u003C/span>\u003Cspan style=\"color:#666666\"> { signal?: \u003C/span>\u003Cspan style=\"color:#BD976A\">AbortSignal\u003C/span>\u003Cspan style=\"color:#666666\"> })\u003C/span>\u003Cspan style=\"color:#DBD7CAEE\">: \u003C/span>\u003Cspan style=\"color:#B8A965\">Promise\u003C/span>\u003Cspan style=\"color:#666666\">&#x3C;\u003C/span>\u003Cspan style=\"color:#BD976A\">V\u003C/span>\u003Cspan style=\"color:#666666\">[]>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Fetch one or more items. Requests in the same tick are batched together.\u003C/p>\n\u003Ch3 id=\"flush\">.flush()\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">flush\u003C/span>\u003Cspan style=\"color:#666666\">()\u003C/span>\u003Cspan style=\"color:#DBD7CAEE\">: \u003C/span>\u003Cspan style=\"color:#B8A965\">Promise\u003C/span>\u003Cspan style=\"color:#666666\">&#x3C;\u003C/span>\u003Cspan style=\"color:#CB7676\">void\u003C/span>\u003Cspan style=\"color:#666666\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Dispatch pending requests immediately, bypassing the scheduler.\u003C/p>\n\u003Ch3 id=\"abort\">.abort()\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">abort\u003C/span>\u003Cspan style=\"color:#666666\">()\u003C/span>\u003Cspan style=\"color:#DBD7CAEE\">: \u003C/span>\u003Cspan style=\"color:#CB7676\">void\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Cancel all pending requests. Rejects with \u003Ccode>AbortError\u003C/code>.\u003C/p>\n\u003Ch3 id=\"name\">.name\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">readonly\u003C/span>\u003Cspan style=\"color:#BD976A\"> name\u003C/span>\u003Cspan style=\"color:#CB7676\">?:\u003C/span>\u003Cspan style=\"color:#BD976A\"> string\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The name passed to \u003Ccode>batch()\u003C/code>, if any.\u003C/p>\n\u003Ch2 id=\"indexed\">indexed\u003C/h2>\n\u003Cp>Symbol for matching object/record responses.\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">import\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> indexed\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#4D9375\"> from\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">batchkit\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  (\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#80A665\"> fetchUsersAsObject\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">),\u003C/span>\u003Cspan style=\"color:#758575DD\">  // Returns { \"1\": user1, \"2\": user2 }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  indexed\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"schedulers\">Schedulers\u003C/h2>\n\u003Ch3 id=\"onanimationframe\">onAnimationFrame\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">import\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> onAnimationFrame\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#4D9375\"> from\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">batchkit\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> { \u003C/span>\u003Cspan style=\"color:#B8A965\">schedule\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#BD976A\">onAnimationFrame\u003C/span>\u003Cspan style=\"color:#666666\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Dispatches on the next animation frame. Syncs with browser rendering.\u003C/p>\n\u003Ch3 id=\"onidle\">onIdle\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">import\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> onIdle\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#4D9375\"> from\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">batchkit\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> { \u003C/span>\u003Cspan style=\"color:#B8A965\">schedule\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#80A665\">onIdle\u003C/span>\u003Cspan style=\"color:#666666\">() })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> { \u003C/span>\u003Cspan style=\"color:#B8A965\">schedule\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#80A665\">onIdle\u003C/span>\u003Cspan style=\"color:#666666\">({ \u003C/span>\u003Cspan style=\"color:#B8A965\">timeout\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#4C9A91\">100\u003C/span>\u003Cspan style=\"color:#666666\"> }) })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Dispatches when the browser is idle. Falls back to \u003Ccode>setTimeout\u003C/code> in non-browser environments.\u003C/p>\n\u003Ch3 id=\"custom-scheduler\">Custom Scheduler\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">type\u003C/span>\u003Cspan style=\"color:#5DA994\"> Scheduler\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#666666\"> (\u003C/span>\u003Cspan style=\"color:#80A665\">dispatch\u003C/span>\u003Cspan style=\"color:#666666\">: () => \u003C/span>\u003Cspan style=\"color:#5DA994\">void\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#666666\"> ()\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#5DA994\"> void\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>A scheduler receives a dispatch function and returns a cleanup function.\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#80A665\">debounced\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">Scheduler\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#666666\"> (\u003C/span>\u003Cspan style=\"color:#BD976A\">dispatch\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">  const \u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> setTimeout\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">dispatch\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#4C9A91\"> 100\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">  return\u003C/span>\u003Cspan style=\"color:#666666\"> ()\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#80A665\"> clearTimeout\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> { \u003C/span>\u003Cspan style=\"color:#B8A965\">schedule\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#BD976A\">debounced\u003C/span>\u003Cspan style=\"color:#666666\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"traceevent\">TraceEvent\u003C/h2>\n\u003Cp>Events emitted when \u003Ccode>trace\u003C/code> is provided.\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">type\u003C/span>\u003Cspan style=\"color:#5DA994\"> TraceEvent\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  |\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> type\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">get\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> key\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">K\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> timestamp\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  |\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> type\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">dedup\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> key\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">K\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> timestamp\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  |\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> type\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">schedule\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> batchId\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">string\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> size\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> timestamp\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  |\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> type\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">dispatch\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> batchId\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">string\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> keys\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">K\u003C/span>\u003Cspan style=\"color:#666666\">[];\u003C/span>\u003Cspan style=\"color:#BD976A\"> timestamp\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  |\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> type\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">resolve\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> batchId\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">string\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> duration\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> timestamp\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  |\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> type\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">error\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> batchId\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">string\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> error\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">Error\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> timestamp\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  |\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> type\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">abort\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> batchId\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">string\u003C/span>\u003Cspan style=\"color:#666666\">;\u003C/span>\u003Cspan style=\"color:#BD976A\"> timestamp\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"batcherror\">BatchError\u003C/h2>\n\u003Cp>Thrown when batchkit encounters an error (e.g., no matching result for a key).\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">import\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> BatchError\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#4D9375\"> from\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">batchkit\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">try\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">  await\u003C/span>\u003Cspan style=\"color:#BD976A\"> users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#4C9A91\">999\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">}\u003C/span>\u003Cspan style=\"color:#4D9375\"> catch\u003C/span>\u003Cspan style=\"color:#666666\"> (\u003C/span>\u003Cspan style=\"color:#BD976A\">e\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">  if\u003C/span>\u003Cspan style=\"color:#666666\"> (\u003C/span>\u003Cspan style=\"color:#BD976A\">e\u003C/span>\u003Cspan style=\"color:#CB7676\"> instanceof\u003C/span>\u003Cspan style=\"color:#5DA994\"> BatchError\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#758575DD\">    // Handle batch-level error\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>",{"headings":21,"imagePaths":70,"frontmatter":11},[22,25,28,32,35,38,41,44,47,50,52,55,58,61,64,67],{"depth":23,"slug":24,"text":12},1,"api-reference",{"depth":14,"slug":26,"text":27},"batch","batch()",{"depth":29,"slug":30,"text":31},3,"parameters","Parameters",{"depth":29,"slug":33,"text":34},"batchoptions","BatchOptions",{"depth":14,"slug":36,"text":37},"batcher","Batcher",{"depth":29,"slug":39,"text":40},"get",".get()",{"depth":29,"slug":42,"text":43},"flush",".flush()",{"depth":29,"slug":45,"text":46},"abort",".abort()",{"depth":29,"slug":48,"text":49},"name",".name",{"depth":14,"slug":51,"text":51},"indexed",{"depth":14,"slug":53,"text":54},"schedulers","Schedulers",{"depth":29,"slug":56,"text":57},"onanimationframe","onAnimationFrame",{"depth":29,"slug":59,"text":60},"onidle","onIdle",{"depth":29,"slug":62,"text":63},"custom-scheduler","Custom Scheduler",{"depth":14,"slug":65,"text":66},"traceevent","TraceEvent",{"depth":14,"slug":68,"text":69},"batcherror","BatchError",[],"use-cases",{"id":71,"data":73,"body":76,"filePath":77,"digest":78,"rendered":79},{"title":74,"description":75,"order":29},"Patterns","Real-world examples","# Patterns\n\n## Database Queries\n\n### Prisma\n\n```typescript\nconst users = batch(\n  (ids) => prisma.user.findMany({ where: { id: { in: ids } } }),\n  'id'\n)\n\nconst posts = batch(\n  (authorIds) => prisma.post.findMany({ \n    where: { authorId: { in: authorIds } } \n  }),\n  'authorId'\n)\n```\n\n### Drizzle\n\n```typescript\nimport { inArray } from 'drizzle-orm'\n\nconst users = batch(\n  (ids) => db.select().from(usersTable).where(inArray(usersTable.id, ids)),\n  'id'\n)\n```\n\n### Raw SQL\n\n```typescript\nconst users = batch(async (ids) => {\n  const placeholders = ids.map(() => '?').join(',')\n  const rows = await db.query(\n    `SELECT * FROM users WHERE id IN (${placeholders})`,\n    ids\n  )\n  return rows\n}, 'id')\n```\n\n## React Components\n\nWhen rendering a list of components that each fetch their own data, batching prevents a flood of requests.\n\n```typescript\nimport { batch } from 'batchkit'\nimport { useQuery } from '@tanstack/react-query'\n\n// Create batcher outside components (singleton)\nconst users = batch(\n  (ids, signal) => \n    fetch(`/api/users?ids=${ids.join(',')}`, { signal })\n      .then(r => r.json()),\n  'id'\n)\n\nfunction UserCard({ userId }: { userId: string }) {\n  const { data, isLoading } = useQuery({\n    queryKey: ['user', userId],\n    queryFn: ({ signal }) => users.get(userId, { signal })\n  })\n\n  if (isLoading) return \u003CSkeleton />\n  return \u003CCard user={data} />\n}\n\nfunction UserList({ userIds }: { userIds: string[] }) {\n  return (\n    \u003Cdiv>\n      {userIds.map(id => \u003CUserCard key={id} userId={id} />)}\n    \u003C/div>\n  )\n}\n```\n\nRendering 100 cards makes one HTTP request.\n\n## Rate-Limited APIs\n\nWhen your API has batch size limits:\n\n```typescript\nconst products = batch(\n  (ids) => shopify.products.list({ ids }),\n  'id',\n  { max: 50 }  // Shopify's limit\n)\n\n// Requesting 200 products makes 4 sequential API calls\nconst products = await batcher.get(allProductIds)\n```\n\n## Caching Layer\n\nbatchkit handles batching only. For caching, integrate with your data layer:\n\n```typescript\nconst cache = new Map\u003Cstring, User>()\n\nconst users = batch(async (ids) => {\n  // Find which IDs aren't cached\n  const uncached = ids.filter(id => !cache.has(id))\n  \n  // Fetch missing items\n  if (uncached.length > 0) {\n    const fetched = await prisma.user.findMany({\n      where: { id: { in: uncached } }\n    })\n    for (const user of fetched) {\n      cache.set(user.id, user)\n    }\n  }\n  \n  // Return all items in request order\n  return ids.map(id => cache.get(id)!)\n}, 'id')\n```\n\nOr use React Query/SWR which handle caching automaticallyâ€”batchkit just handles the batching layer.\n\n## Object Responses\n\nSome APIs return objects keyed by ID instead of arrays:\n\n```json\n{\n  \"user-1\": { \"id\": \"user-1\", \"name\": \"Alice\" },\n  \"user-2\": { \"id\": \"user-2\", \"name\": \"Bob\" }\n}\n```\n\nUse `indexed` to match by object key:\n\n```typescript\nimport { batch, indexed } from 'batchkit'\n\nconst users = batch(\n  async (ids) => {\n    const res = await fetch(`/api/users?ids=${ids.join(',')}`)\n    return res.json()\n  },\n  indexed\n)\n```","src/content/docs/use-cases.md","7be38056d9c43ba2",{"html":80,"metadata":81},"\u003Ch1 id=\"patterns\">Patterns\u003C/h1>\n\u003Ch2 id=\"database-queries\">Database Queries\u003C/h2>\n\u003Ch3 id=\"prisma\">Prisma\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  (\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#BD976A\"> prisma\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">user\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">findMany\u003C/span>\u003Cspan style=\"color:#666666\">({ \u003C/span>\u003Cspan style=\"color:#B8A965\">where\u003C/span>\u003Cspan style=\"color:#666666\">: { \u003C/span>\u003Cspan style=\"color:#B8A965\">id\u003C/span>\u003Cspan style=\"color:#666666\">: { \u003C/span>\u003Cspan style=\"color:#B8A965\">in\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\"> } } }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C98A7D77\">  '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">posts\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  (\u003C/span>\u003Cspan style=\"color:#BD976A\">authorIds\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#BD976A\"> prisma\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">post\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">findMany\u003C/span>\u003Cspan style=\"color:#666666\">({ \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B8A965\">    where\u003C/span>\u003Cspan style=\"color:#666666\">: { \u003C/span>\u003Cspan style=\"color:#B8A965\">authorId\u003C/span>\u003Cspan style=\"color:#666666\">: { \u003C/span>\u003Cspan style=\"color:#B8A965\">in\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#BD976A\">authorIds\u003C/span>\u003Cspan style=\"color:#666666\"> } } \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C98A7D77\">  '\u003C/span>\u003Cspan style=\"color:#C98A7D\">authorId\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"drizzle\">Drizzle\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">import\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> inArray\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#4D9375\"> from\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">drizzle-orm\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  (\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#BD976A\"> db\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">select\u003C/span>\u003Cspan style=\"color:#666666\">().\u003C/span>\u003Cspan style=\"color:#80A665\">from\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">usersTable\u003C/span>\u003Cspan style=\"color:#666666\">).\u003C/span>\u003Cspan style=\"color:#80A665\">where\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#80A665\">inArray\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">usersTable\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> ids\u003C/span>\u003Cspan style=\"color:#666666\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C98A7D77\">  '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"raw-sql\">Raw SQL\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#CB7676\">async \u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">  const \u003C/span>\u003Cspan style=\"color:#BD976A\">placeholders\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#BD976A\"> ids\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">map\u003C/span>\u003Cspan style=\"color:#666666\">(()\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">?\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">).\u003C/span>\u003Cspan style=\"color:#80A665\">join\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">  const \u003C/span>\u003Cspan style=\"color:#BD976A\">rows\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#4D9375\"> await\u003C/span>\u003Cspan style=\"color:#BD976A\"> db\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">query\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C98A7D77\">    `\u003C/span>\u003Cspan style=\"color:#C98A7D\">SELECT * FROM users WHERE id IN (\u003C/span>\u003Cspan style=\"color:#4D9375\">${\u003C/span>\u003Cspan style=\"color:#C98A7D\">placeholders\u003C/span>\u003Cspan style=\"color:#4D9375\">}\u003C/span>\u003Cspan style=\"color:#C98A7D\">)\u003C/span>\u003Cspan style=\"color:#C98A7D77\">`\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">    ids\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">  return\u003C/span>\u003Cspan style=\"color:#BD976A\"> rows\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">},\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"react-components\">React Components\u003C/h2>\n\u003Cp>When rendering a list of components that each fetch their own data, batching prevents a flood of requests.\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">import\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> batch\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#4D9375\"> from\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">batchkit\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">import\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> useQuery\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#4D9375\"> from\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">@tanstack/react-query\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#758575DD\">// Create batcher outside components (singleton)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  (\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> signal\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#CB7676\"> \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">    fetch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#C98A7D77\">`\u003C/span>\u003Cspan style=\"color:#C98A7D\">/api/users?ids=\u003C/span>\u003Cspan style=\"color:#4D9375\">${\u003C/span>\u003Cspan style=\"color:#C98A7D\">ids\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">join\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#4D9375\">}\u003C/span>\u003Cspan style=\"color:#C98A7D77\">`\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> { \u003C/span>\u003Cspan style=\"color:#BD976A\">signal\u003C/span>\u003Cspan style=\"color:#666666\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">      .\u003C/span>\u003Cspan style=\"color:#80A665\">then\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">r\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#BD976A\"> r\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">json\u003C/span>\u003Cspan style=\"color:#666666\">()),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C98A7D77\">  '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">function\u003C/span>\u003Cspan style=\"color:#80A665\"> UserCard\u003C/span>\u003Cspan style=\"color:#666666\">({\u003C/span>\u003Cspan style=\"color:#BD976A\"> userId\u003C/span>\u003Cspan style=\"color:#666666\"> }: { \u003C/span>\u003Cspan style=\"color:#BD976A\">userId\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">string\u003C/span>\u003Cspan style=\"color:#666666\"> })\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">  const \u003C/span>\u003Cspan style=\"color:#666666\">{\u003C/span>\u003Cspan style=\"color:#BD976A\"> data\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> isLoading\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> useQuery\u003C/span>\u003Cspan style=\"color:#666666\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B8A965\">    queryKey\u003C/span>\u003Cspan style=\"color:#666666\">: [\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">user\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">, \u003C/span>\u003Cspan style=\"color:#BD976A\">userId\u003C/span>\u003Cspan style=\"color:#666666\">],\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">    queryFn\u003C/span>\u003Cspan style=\"color:#666666\">: ({ \u003C/span>\u003Cspan style=\"color:#BD976A\">signal\u003C/span>\u003Cspan style=\"color:#666666\"> }) => \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">userId\u003C/span>\u003Cspan style=\"color:#666666\">, { \u003C/span>\u003Cspan style=\"color:#BD976A\">signal\u003C/span>\u003Cspan style=\"color:#666666\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">  if\u003C/span>\u003Cspan style=\"color:#666666\"> (\u003C/span>\u003Cspan style=\"color:#BD976A\">isLoading\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#4D9375\"> return\u003C/span>\u003Cspan style=\"color:#666666\"> &#x3C;\u003C/span>\u003Cspan style=\"color:#5DA994\">Skeleton\u003C/span>\u003Cspan style=\"color:#DBD7CAEE\"> /\u003C/span>\u003Cspan style=\"color:#666666\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#DBD7CAEE\">  return \u003C/span>\u003Cspan style=\"color:#666666\">&#x3C;\u003C/span>\u003Cspan style=\"color:#5DA994\">Card\u003C/span>\u003Cspan style=\"color:#5DA994\"> user\u003C/span>\u003Cspan style=\"color:#666666\">={\u003C/span>\u003Cspan style=\"color:#BD976A\">data\u003C/span>\u003Cspan style=\"color:#666666\">}\u003C/span>\u003Cspan style=\"color:#DBD7CAEE\"> /\u003C/span>\u003Cspan style=\"color:#666666\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#DBD7CAEE\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#DBD7CAEE\">function UserList\u003C/span>\u003Cspan style=\"color:#666666\">({ \u003C/span>\u003Cspan style=\"color:#BD976A\">userIds\u003C/span>\u003Cspan style=\"color:#666666\"> }: { \u003C/span>\u003Cspan style=\"color:#BD976A\">userIds\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">string\u003C/span>\u003Cspan style=\"color:#666666\">[] })\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">  return\u003C/span>\u003Cspan style=\"color:#666666\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">    &#x3C;\u003C/span>\u003Cspan style=\"color:#BD976A\">div\u003C/span>\u003Cspan style=\"color:#666666\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">      {\u003C/span>\u003Cspan style=\"color:#BD976A\">userIds\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">map\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\"> => &#x3C;\u003C/span>\u003Cspan style=\"color:#5DA994\">UserCard\u003C/span>\u003Cspan style=\"color:#5DA994\"> key\u003C/span>\u003Cspan style=\"color:#666666\">={\u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\">} \u003C/span>\u003Cspan style=\"color:#5DA994\">userId\u003C/span>\u003Cspan style=\"color:#666666\">={\u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\">} />)}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">    &#x3C;/\u003C/span>\u003Cspan style=\"color:#BD976A\">div\u003C/span>\u003Cspan style=\"color:#666666\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Rendering 100 cards makes one HTTP request.\u003C/p>\n\u003Ch2 id=\"rate-limited-apis\">Rate-Limited APIs\u003C/h2>\n\u003Cp>When your API has batch size limits:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">products\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  (\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#BD976A\"> shopify\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">products\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">list\u003C/span>\u003Cspan style=\"color:#666666\">({ \u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\"> }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C98A7D77\">  '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  { \u003C/span>\u003Cspan style=\"color:#B8A965\">max\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#4C9A91\">50\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#758575DD\">  // Shopify's limit\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#758575DD\">// Requesting 200 products makes 4 sequential API calls\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">products\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#4D9375\"> await\u003C/span>\u003Cspan style=\"color:#BD976A\"> batcher\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">allProductIds\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"caching-layer\">Caching Layer\u003C/h2>\n\u003Cp>batchkit handles batching only. For caching, integrate with your data layer:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">cache\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#CB7676\"> new \u003C/span>\u003Cspan style=\"color:#80A665\">Map\u003C/span>\u003Cspan style=\"color:#666666\">&#x3C;\u003C/span>\u003Cspan style=\"color:#5DA994\">string\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#5DA994\"> User\u003C/span>\u003Cspan style=\"color:#666666\">>()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#CB7676\">async \u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#758575DD\">  // Find which IDs aren't cached\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">  const \u003C/span>\u003Cspan style=\"color:#BD976A\">uncached\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#BD976A\"> ids\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">filter\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#CB7676\"> !\u003C/span>\u003Cspan style=\"color:#BD976A\">cache\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">has\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">  \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#758575DD\">  // Fetch missing items\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">  if\u003C/span>\u003Cspan style=\"color:#666666\"> (\u003C/span>\u003Cspan style=\"color:#BD976A\">uncached\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#B8A965\">length\u003C/span>\u003Cspan style=\"color:#666666\"> >\u003C/span>\u003Cspan style=\"color:#4C9A91\"> 0\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">    const \u003C/span>\u003Cspan style=\"color:#BD976A\">fetched\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#4D9375\"> await\u003C/span>\u003Cspan style=\"color:#BD976A\"> prisma\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">user\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">findMany\u003C/span>\u003Cspan style=\"color:#666666\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B8A965\">      where\u003C/span>\u003Cspan style=\"color:#666666\">: { \u003C/span>\u003Cspan style=\"color:#B8A965\">id\u003C/span>\u003Cspan style=\"color:#666666\">: { \u003C/span>\u003Cspan style=\"color:#B8A965\">in\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#BD976A\">uncached\u003C/span>\u003Cspan style=\"color:#666666\"> } }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">    })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">    for\u003C/span>\u003Cspan style=\"color:#666666\"> (\u003C/span>\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">user\u003C/span>\u003Cspan style=\"color:#CB7676\"> of \u003C/span>\u003Cspan style=\"color:#BD976A\">fetched\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">      cache\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">set\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">user\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> user\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">  \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#758575DD\">  // Return all items in request order\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">  return\u003C/span>\u003Cspan style=\"color:#BD976A\"> ids\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">map\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#BD976A\"> cache\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#CB7676\">!\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">},\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Or use React Query/SWR which handle caching automaticallyâ€”batchkit just handles the batching layer.\u003C/p>\n\u003Ch2 id=\"object-responses\">Object Responses\u003C/h2>\n\u003Cp>Some APIs return objects keyed by ID instead of arrays:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"json\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B8A96577\">  \"\u003C/span>\u003Cspan style=\"color:#B8A965\">user-1\u003C/span>\u003Cspan style=\"color:#B8A96577\">\"\u003C/span>\u003Cspan style=\"color:#666666\">:\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#B8A96577\"> \"\u003C/span>\u003Cspan style=\"color:#B8A965\">id\u003C/span>\u003Cspan style=\"color:#B8A96577\">\"\u003C/span>\u003Cspan style=\"color:#666666\">:\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> \"\u003C/span>\u003Cspan style=\"color:#C98A7D\">user-1\u003C/span>\u003Cspan style=\"color:#C98A7D77\">\"\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#B8A96577\"> \"\u003C/span>\u003Cspan style=\"color:#B8A965\">name\u003C/span>\u003Cspan style=\"color:#B8A96577\">\"\u003C/span>\u003Cspan style=\"color:#666666\">:\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> \"\u003C/span>\u003Cspan style=\"color:#C98A7D\">Alice\u003C/span>\u003Cspan style=\"color:#C98A7D77\">\"\u003C/span>\u003Cspan style=\"color:#666666\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B8A96577\">  \"\u003C/span>\u003Cspan style=\"color:#B8A965\">user-2\u003C/span>\u003Cspan style=\"color:#B8A96577\">\"\u003C/span>\u003Cspan style=\"color:#666666\">:\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#B8A96577\"> \"\u003C/span>\u003Cspan style=\"color:#B8A965\">id\u003C/span>\u003Cspan style=\"color:#B8A96577\">\"\u003C/span>\u003Cspan style=\"color:#666666\">:\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> \"\u003C/span>\u003Cspan style=\"color:#C98A7D\">user-2\u003C/span>\u003Cspan style=\"color:#C98A7D77\">\"\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#B8A96577\"> \"\u003C/span>\u003Cspan style=\"color:#B8A965\">name\u003C/span>\u003Cspan style=\"color:#B8A96577\">\"\u003C/span>\u003Cspan style=\"color:#666666\">:\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> \"\u003C/span>\u003Cspan style=\"color:#C98A7D\">Bob\u003C/span>\u003Cspan style=\"color:#C98A7D77\">\"\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Use \u003Ccode>indexed\u003C/code> to match by object key:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">import\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> indexed\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#4D9375\"> from\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">batchkit\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">  async \u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">    const \u003C/span>\u003Cspan style=\"color:#BD976A\">res\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#4D9375\"> await\u003C/span>\u003Cspan style=\"color:#80A665\"> fetch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#C98A7D77\">`\u003C/span>\u003Cspan style=\"color:#C98A7D\">/api/users?ids=\u003C/span>\u003Cspan style=\"color:#4D9375\">${\u003C/span>\u003Cspan style=\"color:#C98A7D\">ids\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">join\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#4D9375\">}\u003C/span>\u003Cspan style=\"color:#C98A7D77\">`\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">    return\u003C/span>\u003Cspan style=\"color:#BD976A\"> res\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">json\u003C/span>\u003Cspan style=\"color:#666666\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  indexed\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>",{"headings":82,"imagePaths":109,"frontmatter":73},[83,85,88,91,94,97,100,103,106],{"depth":23,"slug":84,"text":74},"patterns",{"depth":14,"slug":86,"text":87},"database-queries","Database Queries",{"depth":29,"slug":89,"text":90},"prisma","Prisma",{"depth":29,"slug":92,"text":93},"drizzle","Drizzle",{"depth":29,"slug":95,"text":96},"raw-sql","Raw SQL",{"depth":14,"slug":98,"text":99},"react-components","React Components",{"depth":14,"slug":101,"text":102},"rate-limited-apis","Rate-Limited APIs",{"depth":14,"slug":104,"text":105},"caching-layer","Caching Layer",{"depth":14,"slug":107,"text":108},"object-responses","Object Responses",[],"guide",{"id":110,"data":112,"body":115,"filePath":116,"digest":117,"rendered":118},{"title":113,"description":114,"order":23},"Getting Started","How batchkit works","# batchkit\n\nAutomatic batching for async operations.\n\n```bash\nnpm install batchkit\n```\n\n```typescript\nimport { batch } from 'batchkit'\n\nconst users = batch(\n  (ids) => db.users.findMany({ where: { id: { in: ids } } }),\n  'id'\n)\n\n// All calls in the same tick become one db query\nawait Promise.all([\n  users.get(1),\n  users.get(2),\n  users.get(3),\n])\n```\n\n[Try it in the playground â†’](/)\n\n## Creating a Batcher\n\n```typescript\nconst users = batch(fn, match, options?)\n```\n\n**`fn`** is your batch function. It receives an array of keys and should return the corresponding results:\n\n```typescript\nconst users = batch(\n  async (ids: number[]) => {\n    return db.users.findMany({ where: { id: { in: ids } } })\n  },\n  'id'\n)\n```\n\nThe function also receives an `AbortSignal` as a second argument, which you can pass to fetch or other cancellable APIs:\n\n```typescript\nconst users = batch(\n  async (ids, signal) => {\n    return fetch(`/api/users?ids=${ids}`, { signal }).then(r => r.json())\n  },\n  'id'\n)\n```\n\n## Matching Results\n\n**`match`** tells batchkit how to connect each result back to the key that requested it.\n\n### By field name\n\nThe most common case. If your results have an `id` field:\n\n```typescript\nbatch(fn, 'id')\n```\n\nbatchkit finds the result where `result.id === requestedKey`.\n\n### By index (object responses)\n\nWhen your API returns an object keyed by ID:\n\n```json\n{ \"1\": { \"name\": \"Alice\" }, \"2\": { \"name\": \"Bob\" } }\n```\n\nUse `indexed`:\n\n```typescript\nimport { batch, indexed } from 'batchkit'\n\nbatch(fn, indexed)\n```\n\n### Custom matching\n\nFor complex cases, pass a function:\n\n```typescript\nbatch(fn, (results, key) => {\n  return results.find(r => r.externalId === key.id)\n})\n```\n\n## How Batching Works\n\nWhen you call `.get()`, the request is queued. At the end of the current microtask, all queued requests are dispatched together.\n\n```typescript\n// These three calls...\nusers.get(1)\nusers.get(2)\nusers.get(3)\n\n// ...become one call to your batch function:\nfn([1, 2, 3], signal)\n```\n\nDuplicate keys within the same batch are automatically deduplicated. If you call `users.get(1)` twice, the key `1` is only fetched once, but both promises resolve to the same value.\n\n## Timing Control\n\n### Delay dispatching\n\nBy default, batches dispatch immediately (next microtask). Use `wait` to collect requests over a time window:\n\n```typescript\nbatch(fn, 'id', { wait: 50 })  // Wait 50ms before dispatching\n```\n\nThis is useful when requests arrive over time (user scrolling, animations) rather than all at once.\n\n### Custom schedulers\n\nFor advanced control:\n\n```typescript\nimport { batch, onAnimationFrame, onIdle } from 'batchkit'\n\n// Sync with browser rendering\nbatch(fn, 'id', { schedule: onAnimationFrame })\n\n// Low-priority background work\nbatch(fn, 'id', { schedule: onIdle({ timeout: 100 }) })\n```\n\n## Batch Size Limits\n\nSome APIs limit how many items you can request at once. Use `max` to split large batches:\n\n```typescript\nbatch(fn, 'id', { max: 100 })\n```\n\nIf 250 keys are queued, batchkit makes three calls: 100, 100, then 50.\n\n## Cancellation\n\n### Cancel everything\n\n```typescript\nusers.abort()\n```\n\nAll pending requests reject with an `AbortError`. The signal passed to your batch function is also aborted.\n\n### Cancel one request\n\nPass an `AbortSignal` to `.get()`:\n\n```typescript\nconst controller = new AbortController()\nconst promise = users.get(1, { signal: controller.signal })\n\ncontroller.abort()  // This request rejects, others continue\n```\n\nIf all requests in a batch are aborted, the underlying fetch is aborted too.\n\n### Force dispatch\n\nSkip the scheduler and dispatch immediately:\n\n```typescript\nusers.flush()\n```\n\n## Debugging\n\nName your batchers and add tracing:\n\n```typescript\nconst users = batch(fn, 'id', {\n  name: 'users',\n  trace: (event) => console.log(event.type, event)\n})\n```\n\nEvents: `get`, `dedup`, `schedule`, `dispatch`, `resolve`, `error`, `abort`","src/content/docs/guide.md","d24aa63da4c3b812",{"html":119,"metadata":120},"\u003Ch1 id=\"batchkit\">batchkit\u003C/h1>\n\u003Cp>Automatic batching for async operations.\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">npm\u003C/span>\u003Cspan style=\"color:#C98A7D\"> install\u003C/span>\u003Cspan style=\"color:#C98A7D\"> batchkit\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">import\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> batch\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#4D9375\"> from\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">batchkit\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  (\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#BD976A\"> db\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">findMany\u003C/span>\u003Cspan style=\"color:#666666\">({ \u003C/span>\u003Cspan style=\"color:#B8A965\">where\u003C/span>\u003Cspan style=\"color:#666666\">: { \u003C/span>\u003Cspan style=\"color:#B8A965\">id\u003C/span>\u003Cspan style=\"color:#666666\">: { \u003C/span>\u003Cspan style=\"color:#B8A965\">in\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\"> } } }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C98A7D77\">  '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#758575DD\">// All calls in the same tick become one db query\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">await\u003C/span>\u003Cspan style=\"color:#B8A965\"> Promise\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">all\u003C/span>\u003Cspan style=\"color:#666666\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#4C9A91\">1\u003C/span>\u003Cspan style=\"color:#666666\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#4C9A91\">2\u003C/span>\u003Cspan style=\"color:#666666\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">  users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#4C9A91\">3\u003C/span>\u003Cspan style=\"color:#666666\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">])\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Ca href=\"/\">Try it in the playground â†’\u003C/a>\u003C/p>\n\u003Ch2 id=\"creating-a-batcher\">Creating a Batcher\u003C/h2>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> match\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> options\u003C/span>\u003Cspan style=\"color:#CB7676\">?)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>\u003Ccode>fn\u003C/code>\u003C/strong> is your batch function. It receives an array of keys and should return the corresponding results:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">  async \u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#5DA994\">number\u003C/span>\u003Cspan style=\"color:#666666\">[])\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">    return\u003C/span>\u003Cspan style=\"color:#BD976A\"> db\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">findMany\u003C/span>\u003Cspan style=\"color:#666666\">({ \u003C/span>\u003Cspan style=\"color:#B8A965\">where\u003C/span>\u003Cspan style=\"color:#666666\">: { \u003C/span>\u003Cspan style=\"color:#B8A965\">id\u003C/span>\u003Cspan style=\"color:#666666\">: { \u003C/span>\u003Cspan style=\"color:#B8A965\">in\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\"> } } })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C98A7D77\">  '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The function also receives an \u003Ccode>AbortSignal\u003C/code> as a second argument, which you can pass to fetch or other cancellable APIs:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">  async \u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">ids\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> signal\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">    return\u003C/span>\u003Cspan style=\"color:#80A665\"> fetch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#C98A7D77\">`\u003C/span>\u003Cspan style=\"color:#C98A7D\">/api/users?ids=\u003C/span>\u003Cspan style=\"color:#4D9375\">${\u003C/span>\u003Cspan style=\"color:#C98A7D\">ids\u003C/span>\u003Cspan style=\"color:#4D9375\">}\u003C/span>\u003Cspan style=\"color:#C98A7D77\">`\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> { \u003C/span>\u003Cspan style=\"color:#BD976A\">signal\u003C/span>\u003Cspan style=\"color:#666666\"> }).\u003C/span>\u003Cspan style=\"color:#80A665\">then\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">r\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#BD976A\"> r\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">json\u003C/span>\u003Cspan style=\"color:#666666\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C98A7D77\">  '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"matching-results\">Matching Results\u003C/h2>\n\u003Cp>\u003Cstrong>\u003Ccode>match\u003C/code>\u003C/strong> tells batchkit how to connect each result back to the key that requested it.\u003C/p>\n\u003Ch3 id=\"by-field-name\">By field name\u003C/h3>\n\u003Cp>The most common case. If your results have an \u003Ccode>id\u003C/code> field:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>batchkit finds the result where \u003Ccode>result.id === requestedKey\u003C/code>.\u003C/p>\n\u003Ch3 id=\"by-index-object-responses\">By index (object responses)\u003C/h3>\n\u003Cp>When your API returns an object keyed by ID:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"json\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">{\u003C/span>\u003Cspan style=\"color:#B8A96577\"> \"\u003C/span>\u003Cspan style=\"color:#B8A965\">1\u003C/span>\u003Cspan style=\"color:#B8A96577\">\"\u003C/span>\u003Cspan style=\"color:#666666\">:\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#B8A96577\"> \"\u003C/span>\u003Cspan style=\"color:#B8A965\">name\u003C/span>\u003Cspan style=\"color:#B8A96577\">\"\u003C/span>\u003Cspan style=\"color:#666666\">:\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> \"\u003C/span>\u003Cspan style=\"color:#C98A7D\">Alice\u003C/span>\u003Cspan style=\"color:#C98A7D77\">\"\u003C/span>\u003Cspan style=\"color:#666666\"> },\u003C/span>\u003Cspan style=\"color:#B8A96577\"> \"\u003C/span>\u003Cspan style=\"color:#B8A965\">2\u003C/span>\u003Cspan style=\"color:#B8A96577\">\"\u003C/span>\u003Cspan style=\"color:#666666\">:\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#B8A96577\"> \"\u003C/span>\u003Cspan style=\"color:#B8A965\">name\u003C/span>\u003Cspan style=\"color:#B8A96577\">\"\u003C/span>\u003Cspan style=\"color:#666666\">:\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> \"\u003C/span>\u003Cspan style=\"color:#C98A7D\">Bob\u003C/span>\u003Cspan style=\"color:#C98A7D77\">\"\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Use \u003Ccode>indexed\u003C/code>:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">import\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> indexed\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#4D9375\"> from\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">batchkit\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> indexed\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"custom-matching\">Custom matching\u003C/h3>\n\u003Cp>For complex cases, pass a function:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> (\u003C/span>\u003Cspan style=\"color:#BD976A\">results\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> key\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">  return\u003C/span>\u003Cspan style=\"color:#BD976A\"> results\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">find\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">r\u003C/span>\u003Cspan style=\"color:#666666\"> =>\u003C/span>\u003Cspan style=\"color:#BD976A\"> r\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">externalId\u003C/span>\u003Cspan style=\"color:#CB7676\"> ===\u003C/span>\u003Cspan style=\"color:#BD976A\"> key\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">id\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">})\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"how-batching-works\">How Batching Works\u003C/h2>\n\u003Cp>When you call \u003Ccode>.get()\u003C/code>, the request is queued. At the end of the current microtask, all queued requests are dispatched together.\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#758575DD\">// These three calls...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#4C9A91\">1\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#4C9A91\">2\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#4C9A91\">3\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#758575DD\">// ...become one call to your batch function:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">fn\u003C/span>\u003Cspan style=\"color:#666666\">([\u003C/span>\u003Cspan style=\"color:#4C9A91\">1\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#4C9A91\"> 2\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#4C9A91\"> 3\u003C/span>\u003Cspan style=\"color:#666666\">],\u003C/span>\u003Cspan style=\"color:#BD976A\"> signal\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Duplicate keys within the same batch are automatically deduplicated. If you call \u003Ccode>users.get(1)\u003C/code> twice, the key \u003Ccode>1\u003C/code> is only fetched once, but both promises resolve to the same value.\u003C/p>\n\u003Ch2 id=\"timing-control\">Timing Control\u003C/h2>\n\u003Ch3 id=\"delay-dispatching\">Delay dispatching\u003C/h3>\n\u003Cp>By default, batches dispatch immediately (next microtask). Use \u003Ccode>wait\u003C/code> to collect requests over a time window:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> { \u003C/span>\u003Cspan style=\"color:#B8A965\">wait\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#4C9A91\">50\u003C/span>\u003Cspan style=\"color:#666666\"> })\u003C/span>\u003Cspan style=\"color:#758575DD\">  // Wait 50ms before dispatching\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This is useful when requests arrive over time (user scrolling, animations) rather than all at once.\u003C/p>\n\u003Ch3 id=\"custom-schedulers\">Custom schedulers\u003C/h3>\n\u003Cp>For advanced control:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#4D9375\">import\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003Cspan style=\"color:#BD976A\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> onAnimationFrame\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#BD976A\"> onIdle\u003C/span>\u003Cspan style=\"color:#666666\"> }\u003C/span>\u003Cspan style=\"color:#4D9375\"> from\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">batchkit\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#758575DD\">// Sync with browser rendering\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> { \u003C/span>\u003Cspan style=\"color:#B8A965\">schedule\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#BD976A\">onAnimationFrame\u003C/span>\u003Cspan style=\"color:#666666\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#758575DD\">// Low-priority background work\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> { \u003C/span>\u003Cspan style=\"color:#B8A965\">schedule\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#80A665\">onIdle\u003C/span>\u003Cspan style=\"color:#666666\">({ \u003C/span>\u003Cspan style=\"color:#B8A965\">timeout\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#4C9A91\">100\u003C/span>\u003Cspan style=\"color:#666666\"> }) })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"batch-size-limits\">Batch Size Limits\u003C/h2>\n\u003Cp>Some APIs limit how many items you can request at once. Use \u003Ccode>max\u003C/code> to split large batches:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> { \u003C/span>\u003Cspan style=\"color:#B8A965\">max\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#4C9A91\">100\u003C/span>\u003Cspan style=\"color:#666666\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>If 250 keys are queued, batchkit makes three calls: 100, 100, then 50.\u003C/p>\n\u003Ch2 id=\"cancellation\">Cancellation\u003C/h2>\n\u003Ch3 id=\"cancel-everything\">Cancel everything\u003C/h3>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">abort\u003C/span>\u003Cspan style=\"color:#666666\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>All pending requests reject with an \u003Ccode>AbortError\u003C/code>. The signal passed to your batch function is also aborted.\u003C/p>\n\u003Ch3 id=\"cancel-one-request\">Cancel one request\u003C/h3>\n\u003Cp>Pass an \u003Ccode>AbortSignal\u003C/code> to \u003Ccode>.get()\u003C/code>:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">controller\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#CB7676\"> new \u003C/span>\u003Cspan style=\"color:#80A665\">AbortController\u003C/span>\u003Cspan style=\"color:#666666\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">promise\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#BD976A\"> users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">get\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#4C9A91\">1\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> { \u003C/span>\u003Cspan style=\"color:#B8A965\">signal\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#BD976A\">controller\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">signal\u003C/span>\u003Cspan style=\"color:#666666\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">controller\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">abort\u003C/span>\u003Cspan style=\"color:#666666\">()\u003C/span>\u003Cspan style=\"color:#758575DD\">  // This request rejects, others continue\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>If all requests in a batch are aborted, the underlying fetch is aborted too.\u003C/p>\n\u003Ch3 id=\"force-dispatch\">Force dispatch\u003C/h3>\n\u003Cp>Skip the scheduler and dispatch immediately:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">flush\u003C/span>\u003Cspan style=\"color:#666666\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"debugging\">Debugging\u003C/h2>\n\u003Cp>Name your batchers and add tracing:\u003C/p>\n\u003Cpre class=\"astro-code vitesse-dark\" style=\"background-color:#121212;color:#dbd7caee; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#CB7676\">const \u003C/span>\u003Cspan style=\"color:#BD976A\">users\u003C/span>\u003Cspan style=\"color:#666666\"> =\u003C/span>\u003Cspan style=\"color:#80A665\"> batch\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">fn\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#C98A7D77\"> '\u003C/span>\u003Cspan style=\"color:#C98A7D\">id\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003Cspan style=\"color:#666666\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B8A965\">  name\u003C/span>\u003Cspan style=\"color:#666666\">: \u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#C98A7D\">users\u003C/span>\u003Cspan style=\"color:#C98A7D77\">'\u003C/span>\u003Cspan style=\"color:#666666\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#80A665\">  trace\u003C/span>\u003Cspan style=\"color:#666666\">: (\u003C/span>\u003Cspan style=\"color:#BD976A\">event\u003C/span>\u003Cspan style=\"color:#666666\">) => \u003C/span>\u003Cspan style=\"color:#BD976A\">console\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#80A665\">log\u003C/span>\u003Cspan style=\"color:#666666\">(\u003C/span>\u003Cspan style=\"color:#BD976A\">event\u003C/span>\u003Cspan style=\"color:#666666\">.\u003C/span>\u003Cspan style=\"color:#BD976A\">type\u003C/span>\u003Cspan style=\"color:#666666\">, \u003C/span>\u003Cspan style=\"color:#BD976A\">event\u003C/span>\u003Cspan style=\"color:#666666\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#666666\">})\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Events: \u003Ccode>get\u003C/code>, \u003Ccode>dedup\u003C/code>, \u003Ccode>schedule\u003C/code>, \u003Ccode>dispatch\u003C/code>, \u003Ccode>resolve\u003C/code>, \u003Ccode>error\u003C/code>, \u003Ccode>abort\u003C/code>\u003C/p>",{"headings":121,"imagePaths":169,"frontmatter":112},[122,124,127,130,133,136,139,142,145,148,151,154,157,160,163,166],{"depth":23,"slug":123,"text":123},"batchkit",{"depth":14,"slug":125,"text":126},"creating-a-batcher","Creating a Batcher",{"depth":14,"slug":128,"text":129},"matching-results","Matching Results",{"depth":29,"slug":131,"text":132},"by-field-name","By field name",{"depth":29,"slug":134,"text":135},"by-index-object-responses","By index (object responses)",{"depth":29,"slug":137,"text":138},"custom-matching","Custom matching",{"depth":14,"slug":140,"text":141},"how-batching-works","How Batching Works",{"depth":14,"slug":143,"text":144},"timing-control","Timing Control",{"depth":29,"slug":146,"text":147},"delay-dispatching","Delay dispatching",{"depth":29,"slug":149,"text":150},"custom-schedulers","Custom schedulers",{"depth":14,"slug":152,"text":153},"batch-size-limits","Batch Size Limits",{"depth":14,"slug":155,"text":156},"cancellation","Cancellation",{"depth":29,"slug":158,"text":159},"cancel-everything","Cancel everything",{"depth":29,"slug":161,"text":162},"cancel-one-request","Cancel one request",{"depth":29,"slug":164,"text":165},"force-dispatch","Force dispatch",{"depth":14,"slug":167,"text":168},"debugging","Debugging",[]]